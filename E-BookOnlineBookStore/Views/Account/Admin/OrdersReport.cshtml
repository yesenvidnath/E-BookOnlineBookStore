@model System.Data.DataTable

@{
    ViewBag.Title = "Orders Report";
    var monthList = Enumerable.Range(1, 12).Select(m => new { Value = m, Text = new DateTime(1, m, 1).ToString("MMMM") });
    var selectedMonth = ViewBag.Month as int? ?? DateTime.Now.Month;
    var selectedYear = ViewBag.Year as int? ?? DateTime.Now.Year;
}

<h2>Orders Report</h2>

<!-- Month and Year Selection Form -->
<form method="get" action="@Url.Action("OrdersReport", "ManageOrdersReport")">
    <div class="form-group">
        <label for="Month">Select Month:</label>
        <select name="month" id="Month" class="form-control">
            @foreach (var month in monthList)
            {
                if (month.Value == selectedMonth)
                {
                    <option value="@month.Value" selected>@month.Text</option>
                }
                else
                {
                    <option value="@month.Value">@month.Text</option>
                }
            }
        </select>
    </div>
    <div class="form-group">
        <label for="Year">Select Year:</label>
        <input type="number" name="year" id="Year" class="form-control" value="@selectedYear" min="2000" max="2100" />
    </div>
    <!--<button type="submit" class="btn btn-primary">Generate Report</button> -->
</form>

<hr />

<!-- Table displaying the data -->
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Order Status</th>
            <th>Order Count</th>
        </tr>
    </thead>
    <tbody>
        @foreach (System.Data.DataRow row in Model.Rows)
        {
            <tr>
                <td>@row["OrderStatus"]</td>
                <td>@row["OrderCount"]</td>
            </tr>
        }
    </tbody>
</table>

<!-- Link to download the HTML report -->
<a href="@Url.Action("GenerateHtmlReport", "ManageOrdersReport", new { month = selectedMonth, year = selectedYear })" class="btn btn-primary">Download Report</a>

<hr />

<!-- Pie Chart -->
<div style="width: 300px; height: 300px; margin: auto;">
    <canvas id="ordersPieChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Prepare data for the pie chart
    const data = {
        labels: [
    @foreach (System.Data.DataRow row in Model.Rows)
    {
        @: "@row["OrderStatus"]",
    }
            ],
        datasets: [{
            label: 'Orders by Status',
            data: [
    @foreach (System.Data.DataRow row in Model.Rows)
    {
        @: @row["OrderCount"],
    }
                ],
            backgroundColor: [
                'rgba(255, 99, 132, 0.6)', // Cancelled
                'rgba(54, 162, 235, 0.6)', // Completed
                'rgba(255, 206, 86, 0.6)', // Shipped
                'rgba(75, 192, 192, 0.6)', // Pending
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
            ],
            borderWidth: 1
        }]
    };

    // Configure and render the chart
    const config = {
        type: 'pie',
        data: data,
    };

    const ordersPieChart = new Chart(
        document.getElementById('ordersPieChart'),
        config
    );
</script>
